#!/bin/bash
#SBATCH --nodes=132
#SBATCH --exclusive

source ~/.bashrc
conda activate _env312

export DRAGON_DEFAULT_SEG_SZ=21474836480

dragon -N 128 gups_ddict.py --benchit \
                            --benchit_min_nodes=128

## 0.12.3 on Hotlum
## DDict GUPS Benchmark
##   Running on 128 nodes (nclients=8192)
##   256 DDict managers
##   128 DDict nodes
##   2304 GB total DDict memory (1.382E+03 GB for keys+values)
##   Operation: put
##
##  Value [B]  Iters  keys/client  min(ops/s)  max(ops/s)  sum(ops/s)   sum(GB/s)
##       1024      1           64   5.091E+00   5.156E+01   8.177E+04   7.798E-02
##       2048      1           64   5.708E+00   3.068E+01   8.353E+04   1.593E-01
##       4096      1           64   5.203E+00   2.737E+01   7.265E+04   2.771E-01
##       8192      1           64   1.343E+00   3.191E+01   7.217E+04   5.506E-01
##      16384      1           64   1.725E+00   5.374E+01   4.799E+04   7.323E-01
##      32768      1           64   2.236E+00   5.703E+01   7.931E+04   2.420E+00
##      65536      1           64   2.934E+00   3.538E+01   5.111E+04   3.120E+00
##     131072      1           64   1.958E+00   2.318E+01   5.268E+04   6.431E+00
##     262144      1           64   2.597E+00   1.634E+01   4.888E+04   1.193E+01
##     524288      1           64   2.097E+00   2.487E+01   3.986E+04   1.946E+01
##    1048576      1           64   2.065E+00   2.959E+01   4.530E+04   4.423E+01
##    2097152      1           64   2.268E+00   2.429E+01   3.514E+04   6.863E+01
##    4194304      2           43   3.278E+00   3.675E+01   5.377E+04   2.100E+02
##    8388608      3           21   3.664E+00   2.697E+01   5.516E+04   4.309E+02
##   16777216      4           10   2.690E+00   4.001E+01   3.805E+04   5.945E+02
##   33554432      4            5   1.808E+00   1.438E+01   2.650E+04   8.281E+02
##   67108864      4            2   1.102E+00   6.053E+00   1.390E+04   8.687E+02
## DDict GUPS Benchmark
##   Running on 128 nodes (nclients=8192)
##   256 DDict managers
##   128 DDict nodes
##   2304 GB total DDict memory (1.382E+03 GB for keys+values)
##   Operation: batchput
##
##  Value [B]  Iters  keys/client  min(ops/s)  max(ops/s)  sum(ops/s)   sum(GB/s)
##       1024      1           64   4.406E-01   2.157E+01   1.790E+04   1.707E-02
##       2048      1           64   1.247E+00   3.663E+00   1.153E+04   2.199E-02
##       4096      1           64   1.401E+00   4.414E+00   1.323E+04   5.046E-02
##       8192      1           64   1.193E+00   5.984E+00   1.505E+04   1.148E-01
##      16384      1           64   2.870E-01   2.628E+01   1.770E+04   2.701E-01
##      32768      1           64   1.174E+00   2.133E+01   1.792E+04   5.470E-01
##      65536      1           64   7.269E-01   1.511E+01   1.391E+04   8.488E-01
##     131072      1           64   1.138E+00   1.246E+01   1.372E+04   1.674E+00
##     262144      1           64   8.534E-01   1.323E+01   1.249E+04   3.050E+00
##     524288      1           64   1.337E+00   1.723E+01   1.286E+04   6.277E+00
##    1048576      1           64   1.174E+00   7.274E+00   1.160E+04   1.133E+01
##    2097152      1           64   1.036E+00   8.436E+00   1.018E+04   1.988E+01
##    4194304      2           43   1.072E+00   4.943E+00   1.118E+04   4.365E+01
##    8388608      3           21   1.414E+00   2.874E+00   1.274E+04   9.955E+01
##   16777216      4           10   1.305E+00   2.006E+00   1.165E+04   1.820E+02
##   33554432      4            5   1.324E+00   3.447E+00   1.267E+04   3.959E+02
##   67108864      4            2   1.058E+00   4.909E+00   1.183E+04   7.396E+02
## DDict GUPS Benchmark
##   Running on 128 nodes (nclients=8192)
##   256 DDict managers
##   128 DDict nodes
##   2304 GB total DDict memory (1.382E+03 GB for keys+values)
##   Operation: get
##
##  Value [B]  Iters  keys/client  min(ops/s)  max(ops/s)  sum(ops/s)   sum(GB/s)
##       1024      1           64   9.738E+00   1.880E+02   1.286E+05   1.226E-01
##       2048      1           64   3.972E+01   3.994E+02   4.381E+05   8.357E-01
##       4096      1           64   1.830E+01   3.130E+02   3.995E+05   1.524E+00
##       8192      1           64   4.026E+01   2.474E+02   4.361E+05   3.327E+00
##      16384      1           64   3.595E+01   4.652E+02   3.804E+05   5.804E+00
##      32768      1           64   1.924E+01   2.136E+02   2.838E+05   8.659E+00
##      65536      1           64   2.008E+01   1.627E+02   2.489E+05   1.519E+01
##     131072      1           64   2.554E+01   1.143E+02   2.963E+05   3.617E+01
##     262144      1           64   2.654E+01   6.767E+01   2.702E+05   6.597E+01
##     524288      1           64   1.840E+01   5.709E+01   2.236E+05   1.092E+02
##    1048576      1           64   1.469E+01   8.583E+01   1.750E+05   1.709E+02
##    2097152      1           64   1.627E+01   5.442E+01   1.827E+05   3.568E+02
##    4194304      2           43   1.632E+01   4.812E+01   1.613E+05   6.300E+02
##    8388608      3           21   6.436E+00   1.329E+02   7.824E+04   6.112E+02
##   16777216      4           10   5.990E+00   2.234E+01   6.996E+04   1.093E+03
##   33554432      4            5   2.945E+00   9.853E+00   3.272E+04   1.022E+03
##   67108864      4            2   1.410E+00   4.905E+00   1.706E+04   1.066E+03
## DDict GUPS Benchmark
##   Running on 128 nodes (nclients=8192)
##   256 DDict managers
##   128 DDict nodes
##   2304 GB total DDict memory (1.382E+03 GB for keys+values)
##   Operation: frozenget
##
##  Value [B]  Iters  keys/client  min(ops/s)  max(ops/s)  sum(ops/s)   sum(GB/s)
##       1024      1           64   2.368E+01   9.832E+01   4.320E+05   4.120E-01
##       2048      1           64   3.666E+01   4.180E+02   4.169E+05   7.951E-01
##       4096      1           64   3.867E+01   4.564E+02   4.134E+05   1.577E+00
##       8192      1           64   1.774E+01   4.428E+02   3.754E+05   2.864E+00
##      16384      1           64   3.654E+01   1.738E+02   3.829E+05   5.842E+00
##      32768      1           64   3.460E+01   1.035E+02   3.426E+05   1.046E+01
##      65536      1           64   2.224E+01   2.204E+02   2.254E+05   1.376E+01
##     131072      1           64   2.492E+01   6.899E+01   2.802E+05   3.421E+01
##     262144      1           64   2.819E+01   6.117E+01   2.668E+05   6.513E+01
##     524288      1           64   1.889E+01   3.787E+01   1.902E+05   9.289E+01
##    1048576      1           64   2.504E+00   9.299E+01   4.189E+04   4.091E+01
##    2097152      1           64   8.596E-01   5.725E+00   8.446E+03   1.650E+01
##    4194304      2           43   1.456E+01   1.111E+02   1.393E+05   5.443E+02
##    8388608      3           21   8.047E+00   9.615E+01   1.037E+05   8.101E+02
##   16777216      4           10   6.683E+00   2.151E+01   6.869E+04   1.073E+03
##   33554432      4            5   1.718E+00   1.398E+01   2.814E+04   8.794E+02
##   67108864      4            2   1.326E+00   6.245E+00   1.726E+04   1.079E+03
