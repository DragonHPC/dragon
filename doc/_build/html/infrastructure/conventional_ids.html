<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Conventional IDs &mdash; Dragon  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Single Node Deployment" href="single_node_deployment.html" />
    <link rel="prev" title="Process Creation and Interaction" href="processes.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Dragon
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../start/start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uguide/uguide.html">Users Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pguide/pguide.html">Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cbook/cbook.html">Solution Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../benchmarks/benchmarks.html">Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ref/ref.html">API Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="infrastructure.html">Infrastructure</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="architecture.html">Infrastructure Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="messages_api.html">Infrastructure Messages</a></li>
<li class="toctree-l2"><a class="reference internal" href="processes.html">Process Creation and Interaction</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Conventional IDs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#infrastructure-ids">Infrastructure IDs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#process-id">Process ID</a></li>
<li class="toctree-l4"><a class="reference internal" href="#channel-id">Channel ID</a></li>
<li class="toctree-l4"><a class="reference internal" href="#memory-pool-id">Memory Pool ID</a></li>
<li class="toctree-l4"><a class="reference internal" href="#debug-channel-ids">Debug channel IDs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="single_node_deployment.html">Single Node Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="multi_node_deployment.html">Multi Node Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="bootstrapping.html">Infrastructure Bootstrapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../services/services.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../components/components.html">Low-level Components</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Dragon</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="infrastructure.html">Infrastructure</a></li>
      <li class="breadcrumb-item active">Conventional IDs</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/infrastructure/conventional_ids.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="conventional-ids">
<span id="conventionalids"></span><h1>Conventional IDs<a class="headerlink" href="#conventional-ids" title="Permalink to this heading"></a></h1>
<p>The Dragon infrastructure uses process UIDs (<code class="code docutils literal notranslate"><span class="pre">p_uid</span></code>), channel UIDs (<code class="code docutils literal notranslate"><span class="pre">c_uid</span></code>), and memory pool ids (<code class="code docutils literal notranslate"><span class="pre">m_uid</span></code>)
to uniquely identify processes, channels, and memory pools in the runtime system.</p>
<p>Normally these are assigned when these entities are created, but infrastructure actors and default pools will
themselves need to have such IDs for uniformity.   This means that by convention some communications
structures used in bringup and teardown carrying infrastructure messages may have channel uids assigned even
though the channels are not globally accessible, but some special casing is unavoidable.</p>
<section id="infrastructure-ids">
<h2>Infrastructure IDs<a class="headerlink" href="#infrastructure-ids" title="Permalink to this heading"></a></h2>
<p>These are for now for the single node scenario.</p>
<p>The shepherds don’t issue commands; they only execute and reply to them, so shepherd instances don’t need to
have a p_uid.</p>
<section id="process-id">
<span id="p-uid"></span><h3>Process ID<a class="headerlink" href="#process-id" title="Permalink to this heading"></a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 22%" />
<col style="width: 20%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Actor</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Description and notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Launcher</p></td>
<td><p>0</p></td>
<td><p>Launcher starts head user process</p></td>
</tr>
<tr class="row-odd"><td><p>Global Services</p></td>
<td><p>1</p></td>
<td><p>When GS goes parallel the workers might not need
their own IDs.</p></td>
</tr>
<tr class="row-even"><td><p>Transport Services</p></td>
<td><p>2^8 + node_index</p></td>
<td><p>Transport services are assigned p_uid of their
node index offset by base of 2^8. A node index of
2 has a p_uid of 10</p></td>
</tr>
</tbody>
</table>
<p>Managed processes’ IDs are assigned starting with 2^32.</p>
</section>
<section id="channel-id">
<span id="c-uid"></span><h3>Channel ID<a class="headerlink" href="#channel-id" title="Permalink to this heading"></a></h3>
<p>Assigning a c_uid even to things that are not backed by Channels helps because then, as long as the object API
matches on some level, these handles can be dealt with uniformly from a point of view of caching,
initialization, and cleanup - the special casing in the code is only in how they are wrapped.</p>
<p>The shared memory segment name and offset corresponding to the physical location of these channels should come
in along with the launch parameters.</p>
<p>Generally, c_uid below 2^63 are reserved for use by infrastructure.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 34%" />
<col style="width: 49%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Channel</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Description and notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">GS stdin</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">0</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">Held by Shepherd - wrapped stream</div>
<div class="line">Currently unused</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">GS stdout</div>
</div>
</td>
<td><div class="line-block">
<div class="line">1</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Held by Shepherd - wrapped stream</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Global Services</div>
<div class="line">Channel</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">input to global services head.</div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Transport Agent</div>
<div class="line">Channel</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2^55</div>
<div class="line">+ N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">input to transport agent N.</div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Shepherd</div>
<div class="line">Channel</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2^56</div>
<div class="line">+ N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">input to shepherd N;</div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Launcher/Backend</div>
<div class="line">Channel</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">2^57</div>
<div class="line">+ N</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">There is one launcher backend per node. When the</div>
<div class="line">the Shepherd communicates to the front end during</div>
<div class="line">startup or teardown it goes through this backend.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Gateway</div>
<div class="line">Channel</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2^58</div>
<div class="line">+ N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Gateway channels starting point.</div>
<div class="line">Adder is node index N.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Logging Services</div>
<div class="line">Channel</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2^59</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">Channels used from the logging infrastructure.</div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Backend</div>
<div class="line">Infrastructure</div>
<div class="line">Transport</div>
<div class="line">Gateway</div>
<div class="line">Channel</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">2^60</div>
<div class="line">+ host_id</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">Backend cuid used for infrastructure</div>
<div class="line">transport gateway channels.</div>
<div class="line">We use the host_id as the adder (the node index</div>
<div class="line">is not known yet) and we use the modulo operation</div>
<div class="line">to project the produced cuid value inside the</div>
<div class="line">allowed range of values.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Backend</div>
<div class="line">Infrastructure</div>
<div class="line">Local</div>
<div class="line">Channel</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">2^61</div>
<div class="line">+ host_id</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">Backend cuid used for communication with the</div>
<div class="line">infrastructure transport agent.</div>
<div class="line">We use the host_id as the adder (the node index</div>
<div class="line">is not known yet) and we use the modulo operation</div>
<div class="line">to project the produced cuid value inside the</div>
<div class="line">allowed range of values.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Backend</div>
<div class="line">Infrastructure</div>
<div class="line">Frontend</div>
<div class="line">Channel</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">2^62</div>
<div class="line">+ host_id</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">Backend cuid used for communication with the</div>
<div class="line">frontend, while setting up its infrastructure.</div>
<div class="line">We use the host_id as the adder (the node index</div>
<div class="line">is not known yet) and we use the modulo operation</div>
<div class="line">to project the produced cuid value inside the</div>
<div class="line">allowed range of values.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Debug channels</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">2^33</div>
<div class="line">+ N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Channels made dynamically to support debugging</div>
<div class="line">(only in infrastructure pool)</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Process GS</div>
<div class="line">return channel</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2^62 +</div>
<div class="line">M</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Managed process msg return channel from global</div>
<div class="line">services. M not necessarily p_uid</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Process local</div>
<div class="line">M</div>
</div>
</td>
<td><div class="line-block">
<div class="line">3 * 2^61 +</div>
<div class="line">services. M not necessarily p_uid</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>In a multi node case, there will be N conventional shepherd inputs, with IDs assigned consecutively.  Channel
uids for normal processes will be assigned starting at 2^63.  This allows capacity for the runtime to handle
2^60 unique processes and 2^60 nodes, with 2^63 unique channels over a single run, which ‘should be enough for
anybody’.</p>
<section id="managed-process-default-channel-ids">
<h4>Managed Process default channel IDs<a class="headerlink" href="#managed-process-default-channel-ids" title="Permalink to this heading"></a></h4>
<p>Managed processes will need to have some channels created for use by the infrastructure itself.  Each new
process will be able to attach to the GS input and the Shepherd input used by all the other processes, but
each new process also has two other channels unique to itself that are needed to implement multiprocessing
APIs.</p>
<blockquote>
<div><ul class="simple">
<li><p>return messages from Global Services</p></li>
<li><p>return messages from the Shepherd</p></li>
</ul>
</div></blockquote>
<p>It is Global Services’s responsibility to make sure these channels are in place before the managed process
gets started.</p>
<blockquote>
<div><p>Note: as a future optimization there might be a reason to have a single message to the Shepherd to do all
these operations as a fell swoop, to save some message round trips involved in building the channels
first.</p>
</div></blockquote>
<p>The details of which shared memory segment and the offset of these channels will be passed along with the IDs
in the environment.</p>
</section>
</section>
<section id="memory-pool-id">
<span id="m-uid"></span><h3>Memory Pool ID<a class="headerlink" href="#memory-pool-id" title="Permalink to this heading"></a></h3>
<p>Every node has a default memory pool. This is always used for infrastructure channels, and may also be used by
the user application.  The <code class="code docutils literal notranslate"><span class="pre">m_uid</span></code> of the default memory pool on each node is the node index.</p>
<p>In order to separate logging infrastructure from the rest of the services infrastructure, the logging
infrastructure on a node creates a logging memory pool with <code class="code docutils literal notranslate"><span class="pre">m_uid</span></code> starting at 2^61.</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">m_uid</span></code> from user created pools will start at 2^63.</p>
</section>
<section id="debug-channel-ids">
<h3>Debug channel IDs<a class="headerlink" href="#debug-channel-ids" title="Permalink to this heading"></a></h3>
<p>Debug channels are created as-needed by processes in the infrastructure.  Their <a class="reference internal" href="#c-uid"><span class="std std-ref">Channel ID</span></a> only has meaning
in the context of the ‘infrastructure pool’ on each node, and start at 2^33.  Uniqueness is assured in that
context via the creating process’s Unix pid.  These channels are not registered by the infrastructure.
Debugging systems must manage these descriptors directly, including knowing what node they correspond to and
what <a class="reference internal" href="#p-uid"><span class="std std-ref">Process ID</span></a> made them.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="processes.html" class="btn btn-neutral float-left" title="Process Creation and Interaction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="single_node_deployment.html" class="btn btn-neutral float-right" title="Single Node Deployment" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Hewlett Packard Enterprise.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>