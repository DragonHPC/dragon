<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Distributed Dragon Dictionary &mdash; Dragon  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Benchmarks" href="../benchmarks/benchmarks.html" />
    <link rel="prev" title="An example MPI workflow using Dragon ProcessGroup" href="dragon_mpi_workflow.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Dragon
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../start/start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uguide/uguide.html">Users Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pguide/pguide.html">Programming Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="cbook.html">Solution Cookbook</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="cbook.html#multiprocessing-with-dragon">Multiprocessing with Dragon</a></li>
<li class="toctree-l2"><a class="reference internal" href="cbook.html#dragon-native">Dragon Native</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="cbook.html#dragon-data-preview">Dragon Data (Preview)</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Distributed Dragon Dictionary</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#architecture-of-dragon-dictionay">Architecture of Dragon Dictionay</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-of-dragon-dictionay-shared-by-the-multiprocessing-mp-processes">Example of Dragon Dictionay shared by the multiprocessing (mp) processes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#results-on-a-multi-node-setup">Results on a multi-node setup</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../benchmarks/benchmarks.html">Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ref/ref.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/infrastructure.html">Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/services.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../components/components.html">Low-level Components</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Dragon</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="cbook.html">Solution Cookbook</a></li>
      <li class="breadcrumb-item active">Distributed Dragon Dictionary</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/cbook/dragon_dict.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="distributed-dragon-dictionary">
<h1>Distributed Dragon Dictionary<a class="headerlink" href="#distributed-dragon-dictionary" title="Permalink to this heading"></a></h1>
<p>Dragon provides the core capabilities needed to implement an efficient multi-node dictionary. With Dragon’s transparent multi-node support, the
Distributed Dragon Dictionary delivers a powerful communication foundation that is dynamic and flexible enough for distributed services.
Additionally, Dragon managed memory is capable of efficient shared memory partitioning, which satisfies many of the requirements for handling arbitrary data
structures in a dictionary. The Distributed Dragon Dictionary uses these technologies along with namespace and process management services of Dragon to provide
a highly productive and simple to use tool for communication among a set of distributed processes.</p>
<section id="architecture-of-dragon-dictionay">
<h2>Architecture of Dragon Dictionay<a class="headerlink" href="#architecture-of-dragon-dictionay" title="Permalink to this heading"></a></h2>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="../_images/dragon_dict_architecture.png"><img alt="../_images/dragon_dict_architecture.png" src="../_images/dragon_dict_architecture.png" style="width: 660.0px; height: 258.0px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 14 </span><span class="caption-text"><strong>Figure 1: High-level architecture of a Dragon Dictionary</strong></span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>From Python code, a user instantiates a dragon dictionary specifying the number of back-end managers. During bring-up of a dragon dictionary,
a pool of manager processes are started along with a collection of dragon channels used for communication between clients and managers. Each of the managers
supporting the dragon dictionary holds a shard of the distributed dictionary and has a dedicated input connection it monitors for operation requests,
such as a put or get, coming from any client. The manager processes are also associated with a pool that stores the (key, value) pairs of the dictionary.
Once initialized, a dragon dictionary can be shared with other processes. A common hash function translates a key to one of the manager channels.
This translation occurs entirely local to a client process and allows the dictionary to efficiently scale.</p>
</section>
<section id="example-of-dragon-dictionay-shared-by-the-multiprocessing-mp-processes">
<h2>Example of Dragon Dictionay shared by the multiprocessing (mp) processes<a class="headerlink" href="#example-of-dragon-dictionay-shared-by-the-multiprocessing-mp-processes" title="Permalink to this heading"></a></h2>
<p>Here we show a simple demonstration of the dragon dictionary functionality with distributed clients, using the dictionary object. With the current dragon
multiprocessing implementation, each new process is spawned on a new node in a round-robin fashion in a multinode setup. The dictionary is instantiated spawning
across two-nodes with one manager process on each node. Each manager process is also associated with a pool of size 2GB. Client Process 1 picks a dictionary object,
and stores the (key, value) pair (“Hello”, “Dragon”), while client process 2 retrieves the value from the dictionary using the same key. This demonstrates the object
can be shared across the client processes to perform data storage operations on the dictionary.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-number">Listing 22 </span><span class="caption-text"><strong>distributed_dict_client.py: store and retrieve value from mp client processes using dragon dictionary</strong></span><a class="headerlink" href="#id2" title="Permalink to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">dragon</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="linenos"> 3</span><span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="k">as</span> <span class="nn">mp</span>
<span class="linenos"> 4</span><span class="kn">from</span> <span class="nn">dragon.data.distdictionary.dragon_dict</span> <span class="kn">import</span> <span class="n">DragonDict</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="k">def</span> <span class="nf">_retrieve_value</span><span class="p">(</span><span class="n">_dict</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">client_id</span><span class="p">):</span>
<span class="linenos"> 7</span>    <span class="n">value</span> <span class="o">=</span> <span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<span class="linenos"> 8</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Retrieving value:</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1"> for key:</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"> for client id:</span><span class="si">{</span><span class="n">client_id</span><span class="si">}</span><span class="s1"> from the dictionary&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 9</span>    <span class="k">return</span> <span class="n">value</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="k">def</span> <span class="nf">_store_key_value</span><span class="p">(</span><span class="n">_dict</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">client_id</span><span class="p">):</span>
<span class="linenos">12</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Storing key:</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"> and value:</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1"> from client id:</span><span class="si">{</span><span class="n">client_id</span><span class="si">}</span><span class="s1"> into the dictionary&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">13</span>    <span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">16</span>    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Distributed dictionary example&#39;</span><span class="p">)</span>
<span class="linenos">17</span>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--num_nodes&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">18</span>                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;number of nodes the dictionary distributed across&#39;</span><span class="p">)</span>
<span class="linenos">19</span>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--managers_per_node&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">20</span>                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;number of managers per node for the dragon dict&#39;</span><span class="p">)</span>
<span class="linenos">21</span>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--total_mem_size&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">22</span>                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;total managed memory size for dictionary in GB&#39;</span><span class="p">)</span>
<span class="linenos">23</span>
<span class="linenos">24</span>    <span class="n">my_args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="linenos">25</span>    <span class="n">mp</span><span class="o">.</span><span class="n">set_start_method</span><span class="p">(</span><span class="s2">&quot;dragon&quot;</span><span class="p">)</span>
<span class="linenos">26</span>
<span class="linenos">27</span>    <span class="c1"># Instantiate the dictionary and start the processes</span>
<span class="linenos">28</span>    <span class="n">total_mem_size</span> <span class="o">=</span> <span class="n">my_args</span><span class="o">.</span><span class="n">total_mem_size</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span>
<span class="linenos">29</span>    <span class="n">dd</span> <span class="o">=</span> <span class="n">DragonDict</span><span class="p">(</span><span class="n">my_args</span><span class="o">.</span><span class="n">managers_per_node</span><span class="p">,</span> <span class="n">my_args</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">total_mem_size</span><span class="p">)</span>
<span class="linenos">30</span>
<span class="linenos">31</span>    <span class="n">client_proc_1</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">_store_key_value</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">dd</span><span class="p">,</span> <span class="s2">&quot;Hello&quot;</span><span class="p">,</span> <span class="s2">&quot;Dragon&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="linenos">32</span>    <span class="n">client_proc_1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="linenos">33</span>    <span class="n">client_proc_1</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<span class="linenos">34</span>
<span class="linenos">35</span>    <span class="n">client_proc_2</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">_retrieve_value</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">dd</span><span class="p">,</span> <span class="s2">&quot;Hello&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="linenos">36</span>    <span class="n">client_proc_2</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="linenos">37</span>    <span class="n">client_proc_2</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<span class="linenos">38</span>
<span class="linenos">39</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done here. Closing the Dragon Dictionary&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">40</span>    <span class="n">dd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>The lines below show the output of the above code where client process with id:1 stores and client process with id:2 retrieves the value from the dictionary</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>&gt;$dragon distributed_dict_client.py --num_nodes=2 --managers_per_node=1 --total_mem_size=2
<span class="linenos">2</span>Storing key:Hello and value:Dragon from client id:1 into the dictionary
<span class="linenos">3</span>Retrieving value:Dragon for key:Hello for client id:2 from the dictionary
<span class="linenos">4</span>Done here. Closing the Dragon Dictionary
</pre></div>
</div>
</section>
<section id="results-on-a-multi-node-setup">
<h2>Results on a multi-node setup<a class="headerlink" href="#results-on-a-multi-node-setup" title="Permalink to this heading"></a></h2>
<p>Below are the results of aggregated operations on a dragon dictionary with a 64 node setup and High Speed Transport Agent (HSTA). The results are
collected with 256 distributed client processes performing the operations on dictionary in parallel with a total of 8192 kv pairs in the dictionary.
The dictionary is spawned from across 1 node to 64 nodes with each manager worker per node. The value sizes are varied with 8 bytes and 8 kilobytes,
with each key of constant size of 30 bytes in the dictionary. The results clearly demonstrate the advantage of distributed dictionary, with increased
aggregated rate of opearations as the dictionary managers are spawned across the increasing number of nodes.</p>
<figure class="align-center" id="id3">
<a class="reference internal image-reference" href="../_images/dragon_dict_results.png"><img alt="../_images/dragon_dict_results.png" src="../_images/dragon_dict_results.png" style="width: 725.25px; height: 461.75px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 15 </span><span class="caption-text"><strong>Figure 2: Results on a multi-node setup</strong></span><a class="headerlink" href="#id3" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="dragon_mpi_workflow.html" class="btn btn-neutral float-left" title="An example MPI workflow using Dragon ProcessGroup" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../benchmarks/benchmarks.html" class="btn btn-neutral float-right" title="Benchmarks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Hewlett Packard Enterprise.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>